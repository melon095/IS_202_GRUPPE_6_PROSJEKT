    @{
        ViewBag.Title = "ReportReview";
    }
    @model Kartverket.Web.Models.Report.Response.ReportReviewModel



<div id="model-title">
    <h2 class="is-size-2">
        Rapport: @Model.Title
    </h2>
    <a asp-controller="Admin"
       asp-action="ReportInDepth"
       asp-route-id="@Model.Id">Tilbake</a>
</div>
<body>
    <div class="main-container">
        <!-- Venstre og midtre kolonne (RAPPORT + OBJEKTER) -->
        <div class="left-section">
            <div class="top-row">
                <!-- RAPPORT -->
                <div class="box custom-outline rapport-box">
                    <p class="is-size-5">@Model.Description</p>
                    <br />
                    <p>Godta eller avslå</p>
                    <br />
                    <p class="is-size-7">(OBS, Dersom ikke alle objekter er vurdert, vil de endres basert på svar)</p>
                    <p><strong>Status:</strong> @Model.ReviewStatus</p>
                    @using (Html.BeginForm("ReportReview", "Admin", FormMethod.Post))
                    {
                        @Html.HiddenFor(m => m.Id)
                        <div>
                            <p class="is-size-5">Aksepter</p>
                            <div>

                                <div class="control">
                                    <button type="submit" name="Status" value="accept" class="button is-success is-small">Aksepter</button>
                                    <button type="submit" name="Status" value="deny" class="button is-danger is-small">Avslå</button>
                                </div>
                            </div>

                        </div>
                    }
                </div>

                <!-- OBJEKTER -->
                <div class="box custom-outline objekter-box">
                    <h2>Objects</h2>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Object Num</th>
                                <th>Markers</th>
                                <th>Edit</th>
                                <th>Statement</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var obj in Model.Objects)
                            {
                                <tr>
                                    <td>@obj.Title</td>
                                    <td>@obj.Points.Count</td>
                                    <td>
                                        <a id="showIn"
                                           asp-controller="Admin"
                                           asp-action="ReportReview"
                                           asp-route-id="@Model.Id"
                                           asp-route-objectId="@obj.Id">Details</a>
                                    </td>
                                    <td>
                                        @using (Html.BeginForm("ReportReview", "Admin", FormMethod.Post))
                                        {
                                            @Html.Hidden("objectId", obj.Id)
                                            <div>
                                                <div>

                                                    <div class="control">
                                                        <button type="submit" name="StatusObject" value="accept" class="button is-success">Aksepter</button>
                                                        <button type="submit" name="StatusObject" value="deny" class="button is-danger">Avslå</button>
                                                    </div>
                                                </div>

                                            </div>
                                        }
                                    </td>
                                </tr>
                            }


                        </tbody>
                    </table>
                </div>
            </div>

            <!-- KOMMENTAR (under hele venstre seksjon) -->
            <div class="box custom-outline kommentar-box">
                <h2>KOMMENTAR</h2>
                <p>Kommentarer vises her...</p>
            </div>
        </div>

        <!-- KART (egen kolonne til høyre) -->
        <div class="box custom-outline kart-box">
            <div id="map"></div>
        </div>
    </div>

</body>

@section styles
{
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        html, body {
            height: 100%;
        }

        .main-container {
            display: flex;
            height: 100vh;

        }

        /* Venstre del (Rapport + Objekter + Kommentar) */
        .left-section {
            display: flex;
            flex-direction: column;
            flex: 2;
            gap: 0.1rem;
        }

        /* Øverste rad med Rapport + Objekter side om side */
        .top-row {
            display: flex;

        }

        .box {
            margin-top 0;
        }


        .rapport-box {
            height: 80%;
            width: 50%;
            flex: 1;
            overflow-x: auto;
        }

        .objekter-box {
            height: 80%;
            flex: 1;
            overflow-x: auto;
        }

        /* Kommentar nederst, går over hele bredden av venstre seksjon */
        .kommentar-box {
            flex: 1;
        }

        /* Kart (egen kolonne til høyre) */
        .kart-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 0; /* Removes double spacing inside box */
        }

        #map {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none; /* Remove any inner box border */
            border-radius: 0 0 6px 6px; /* Optional: smooth bottom corners */
        }

        ul {
            list-style-type: none;
            padding-left: 0;
        }

            ul li {
                margin-bottom: 0.5rem;
            }

        h2 {
            margin-bottom: 0.5rem;
        }

        .custom-outline {
            border: 1px solid #dbdbdb; /* Example border */
        }
    </style>
}
@section Scripts {
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const centerOfNorway = [63.99164652261938, 12.306951660170679];
        const { Objects: objects, SelectedObject: selectedObject } = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model));
        let mapCenter = [58.16358810163733, 8.00377215125247];
        let zoomLevel = 10;
        let bounds = null;

        if (selectedObject && selectedObject.CentroidPoint)
        {
            let centroid = selectedObject.CentroidPoint;
            var points = selectedObject.Points;
            mapCenter = [selectedObject.CentroidPoint.Lat, selectedObject.CentroidPoint.Lng];

            let latLngPoints = points.map((p) => L.latLng(p.Lat, p.Lng));
            bounds = L.latLngBounds(latLngPoints);
            bounds.extend([centroid.Lat, centroid.Lng]);
        } else {
            let latLngPoints = objects.flatMap(o => o.Points.map(p => L.latLng(p.Lat, p.Lng)));
            bounds = L.latLngBounds(latLngPoints);
            bounds.extend(centerOfNorway);
        }

        const map = L.map('map').setView(mapCenter, zoomLevel);
        map.fitBounds(bounds, {
            padding: [50, 50]
        });

        L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png', {
            attribution: '&copy; <a href="http://www.kartverket.no/">Kartverket</a>'
        }).addTo(map);

        objects.forEach(obj => {
            if (obj.Points && obj.Points.length > 0)
            {
                obj.Points.forEach(point =>
                    {
                if (point.Lat && point.Lng)
                {
                    L.marker([point.Lat, point.Lng]).addTo(map).bindPopup(obj.Description);
                }
            });
            }
        });
    </script>
}

<br />
<br />
<br />
        <pre>@System.Text.Json.JsonSerializer.Serialize(@Model, new System.Text.Json.JsonSerializerOptions()
        {
            WriteIndented = true
        })</pre>
