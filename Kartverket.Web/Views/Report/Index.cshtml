@using Kartverket.Web.Database
@model Kartverket.Web.Models.Report.ReportIndexViewModel
@{
    ViewBag.Title = "Rapporter";
}

<div class="box">
    <h2 class="is-size-3">Rapporter</h2>
</div>

<div class="box mt-1">
    <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
        @using (Html.BeginForm("Index", "Report", FormMethod.Get))
        {
            <div>
                <p class="is-size-5">Filtrer</p>
                <label for="SelDate">Før dato</label>
                <input
                    type="date"
                    id="SelDate"
                    name="SortDate"
                    value="@(Model.SortDate.ToString("yyyy-MM-dd"))"/>
                <label for="SelStatus">Status</label>
                <select asp-for="SortStatus" asp-items="Html.GetEnumSelectList<ReviewStatus>()"
                        id="SelStatus">
                    <!option value="">Alle raporter</!option>
                </select>
                <input type="submit" value="Filtrer">
            </div>
        }
        <tr>
            <th>Lagd av</th>
            <th>Rapport</th>
            <th>Objekter</th>
            <th>Status</th>
            <th>Åpne</th>
            <th>
                <a class="nav-link text-dark"
                   asp-controller="Report"
                   asp-action="Details"
                   asp-route-sortDate="@Model.SortDate.ToString("yyyy-MM-dd")"
                   asp-route-sortOrder="@(ViewBag.SortOrder == "asc" ? "desc" : "asc")"
                   asp-route-SortDate="@(Model.SortOrder)">
                    @(ViewBag.SortOrder == "asc" ? "▲" : "▼")
                </a>
                Dato
            </th>
        </tr>
        </thead>
        <tbody>
        @foreach (var report in Model.Reports)
        {
            <tr>
                <td>@report.User</td>
                <td>@report.Title</td>
                <td>
                    @report.TotalObjects
                </td>
                <td>@report.Review.GetDisplayName()</td>
                <td>
                    <a class="nav-link, text-dark"
                       asp-controller="Admin"
                       asp-action="ReportInDepth"
                       asp-route-id="@report.Id"
                    >
                        Åpne
                    </a>
                </td>
                <td>
                    @report.CreatedAt</td>
            </tr>
        }
        </tbody>
    </table>
</div>
<div class="columns is-centered">
    <div class="Pagination">
        <nav class="pagination is-centered" role="navigation">
            @if (Model.CurrentPage > 1)
            {
                <a class="pagination-previous"
                   asp-action="Index"
                   asp-route-page="@(Model.CurrentPage - 1)"
                   asp-route-SortDate="@Context.Request.Query["SortDate"]"
                   asp-route-SortOrder="@Context.Request.Query["SortOrder"]"
                   asp-route-SortStatus="@Context.Request.Query["SortStatus"]">
                    Previous
                </a>
            }
            else
            {
                <a class="pagination-previous" disabled>
                    Previous
                </a>
            }

            @if (Model.CurrentPage < Model.TotalPages)
            {
                <a class="pagination-next"
                   asp-action="Index"
                   asp-route-page="@(Model.CurrentPage + 1)"
                   asp-route-SortDate="@Context.Request.Query["SortDate"]"
                   asp-route-SortOrder="@Context.Request.Query["SortOrder"]"
                   asp-route-SortStatus="@Context.Request.Query["SortStatus"]">
                    Next
                </a>
            }
            else
            {
                <a class="pagination-next" disabled>
                    Next
                </a>
            }
            <ul class="pagination-list">
                @for (var i = 1; i <= Model.TotalPages; i++)
                {
                    <li>
                        @if (i == Model.CurrentPage)
                        {
                            <a class="pagination-link column is-half" disabled>@i</a>
                        }
                        else
                        {
                            <a class="pagination-link
                            column is-half"
                               asp-action="Index"
                               asp-route-page="@i">
                                @i
                            </a>
                        }
                    </li>
                }
            </ul>

        </nav>
    </div>
</div>
